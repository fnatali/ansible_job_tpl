---
- name: Delete instances
  hosts: localhost
  gather_facts: yes
  vars:
      gcp_project: mylab-465509 
      gcp_cred_kind: serviceaccount
      gcp_cred_file: /var/lib/awx/projects/_12__myfn/sa.json
      zone: "europe-west3-c"
      region: "europe-west3"
  tasks:
  - name: create a disk
    google.cloud.gcp_compute_disk:
      name: disk-instance
      size_gb: 50
      source_image: projects/ubuntu-os-cloud/global/images/family/ubuntu-1604-lts
      zone: us-central1-a
      project: "{{ gcp_project }}"
      auth_kind: "{{ gcp_cred_kind }}"
      service_account_file: "{{ gcp_cred_file }}"
      state: present
    register: disk
  
  - name: create a network
    google.cloud.gcp_compute_network:
      name: network-instance
      project: "{{ gcp_project }}"
      auth_kind: "{{ gcp_cred_kind }}"
      service_account_file: "{{ gcp_cred_file }}"
      state: present
    register: network
  
  - name: create a address
    google.cloud.gcp_compute_address:
      name: address-instance
      region: us-central1
      project: "{{ gcp_project }}"
      auth_kind: "{{ gcp_cred_kind }}"
      service_account_file: "{{ gcp_cred_file }}"
      state: present
    register: address
  
  - name: create a instance
    google.cloud.gcp_compute_instance:
      name: test_object
      machine_type: n1-standard-1
      disks:
      - auto_delete: 'true'
        boot: 'true'
        source: "{{ disk }}"
      - auto_delete: 'true'
        interface: NVME
        type: SCRATCH
        initialize_params:
          disk_type: local-ssd
      metadata:
        startup-script-url: gs:://graphite-playground/bootstrap.sh
        cost-center: '12345'
      labels:
        environment: production
      network_interfaces:
      - network: "{{ network }}"
        access_configs:
        - name: External NAT
          nat_ip: "{{ address }}"
          type: ONE_TO_ONE_NAT
      zone: us-central1-a
      project: mylab-465509 
      auth_kind: serviceaccount
      service_account_file: "{{ gcp_cred_file }}"
      service_account_contents: '{  "type": "service_account",  "project_id": "mylab-465509",  "private_key_id": "8324a4147ac8d958caf638163530277ea4e3fe81",  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC/fZdNc0ag5ia3\nQzIx/y4DgLFjQepQNaE2Hope6kJGQVDxOP6EMQbnp5TEKD4qtgeu1kbjNcc9+aQr\nbidhvgu7TjrajaiqwC11RuuqY/lIkPmR3veKwPDcEpJ/4YnsDnmheiX/YsL73/gQ\nhoFWcTDAz7uR+NxyL379vedwTiZaB7rc+jOjG6oUE3WLY8Mw5LYU215c0LCW+QZ0\nIFXFqWGhP6WaYWuzz8osXH/W6f301/m9ZNoTNfTZ9SxzjpSJJIeCUUOTROUyu4fk\nIVbe77Ob/Ni+a6QK4kuAjcyt+FJKA5/l/Cw1ZTHBpyLKJDBcrT6MpfoJb66xVuXN\nDXCCmKG/AgMBAAECggEADwtyAL7G1MtgTVO1NOJknhfVWAQMwcKE6PibTHvBOz3U\ney9MJ9ymOzsaYBL9V2O31M+3ABDwl3juog7kfzRsPYoW66bnkorIx4cL6vYx1ra1\nNPW8oyUnh1LaObvhly9H9RzgsWD0Cs/88Gdw7/ayquNnTD+uKjZ7Frp93X/2WWpQ\n+qKEQjlDCJWpQwoQg2Oo4irVM+zMu/IPTPz3H+DXDN5stNOMjgrjRy7msGAEu26X\nrGTm5G3RklG5h6NmATB4nzs5yoAsFU8B7xbnXQhZOdqxD+NRYn1Z97+2jSagUvbo\nTVCsgQ+fh7LDBxLmuMxqaF3O+TwFMmXuRUVXWcLAKQKBgQD72JAm8THIyJa0dGRD\nBfvnH7SF69dyq02+9S4yFW9xeUaIMY7+X5Prj38L9aSju4VXMUiJKab/gBaJ28v6\nWgMrRf7k4ghtTnpRtrnvS5YRpkFRS8syLDJN2H4nYWF2w9mmqztLJ5Yhf1tT27YD\n+zJwyHnaLzkFkRxK+nZsCz5YxQKBgQDCpixat06Yw2xa1YCw9/CAT81u8289ldDN\n7pmik9bA43ADPr9dsCQjUe42z+JO3aA9eHF4LGTyQvwGtSW1c0VEL8zf+Ues94p8\nBuFXXtygtPQc31eLSRkSofYsyd7s8iQLN2xqo05Dc/NGA9zOk7z3/PCk8kcL2IdW\nM4Km12dQswKBgQDL5jYvkS/BY8XALEvQh9O++Ehr9NnmGRNE+7R/ECO+N3YHZjhj\ncnaMTQ2LXUIC3hvC0D/t7S8rxUR6MN4gvye5rV4FaYtxFAysg8heGVBS0cwoSbkl\n0eqYZCMfNxR113MsIY5L9qzySe5jIotnBcV80pL1Ny5vd2D0w3uFVkUQEQKBgAT6\nUvAO+AeYF9FK3HuqG5Bsegh4WUPt7OUXUP6DYV6Vcmvi0uoGcyYkFj94mYUCzfJE\nfkJggERhyigxwcEeLYtM3aRsr5SQ0A3T7zdYybOibQu/+nEpcWa0laMXlofguWNA\nC5m+i2XWNUZ5GtB9nruI0G6nc4GuC+f8cT7rC01ZAoGAHajPvD1BeUgLufqIu1+h\n06VXwclCYOjNTfLn7NefeFz30GgoGd1F86QF5e7L9i8a/WH6uL8CmLMCTWeUiSYH\nR4Kwle3p5nrJvUWbeg2wuIypUBfuphRruH/YOva747JJ2i0KUPMiDKgqEzb5vrz+\nApxbHSyIJvnXtI2ZxvFc2ro=\n-----END PRIVATE KEY-----\n",  "client_email": "felixbuckman@mylab-465509.iam.gserviceaccount.com",  "client_id": "105115672940783815507",  "auth_uri": "https://accounts.google.com/o/oauth2/auth",  "token_uri": "https://oauth2.googleapis.com/token",  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/felixbuckman%40mylab-465509.iam.gserviceaccount.com",  "universe_domain": "googleapis.com"}'
      state: present
